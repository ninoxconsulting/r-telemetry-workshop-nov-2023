{
  "hash": "ae8fb9491809d29bbaabd4807a796450",
  "result": {
    "markdown": "---\ntitle: \"Processing Base Vector Data\"\nexecute: \n  cache: true\nparams:\n  write: false\n---\n\n\n## Overview:\n\nIn this module we will post-process the vector data we prepared earlier to generate some additional covariates using the **terra** package. We will also prepare all data for the analysis. This includes  \n\n-   generating a road density layer\n\n-   calculating distance to water metrics\n\n-   converting our prepared vector to raster\n\n-   building a raster stack with all covariate data\n\n\n## 1. Calculate density of road network. \n\nOften we want to post-process our raw vector data to create more meaningful covariates in our analysis. In this case we are interested in the density of roads and how this might impact our caribou habitat choice. \n\n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-1_526d426289b4964153e33da6174c7045'}\n\n```{.r .cell-code}\n# load in the libraries needed\n\nlibrary(bcdata)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'bcdata'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:stats':\n\n    filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'dplyr'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n:::\n\n```{.r .cell-code}\nlibrary(terra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nterra 1.7.55\n```\n:::\n\n```{.r .cell-code}\n# read in raster template\ntemplate <- rast(file.path(\"clean_data\", \"template.tif\"))\n```\n:::\n\n\nWe can assume that the type of road will have a different impact on Caribou avoidance or predator use. We can assign a value based on the road type. In this case we will assign a higher value to roads used more frequently.\n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-2_bbb72a239a1626c1c31661a95179276a'}\n\n```{.r .cell-code}\n# read in roads\nroads <- st_read(file.path(\"clean_data\", \"roads.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `roads' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/roads.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1077 features and 2 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\n# assign a value to the roads based on estimated speed of travel or use\n\nroads <- roads %>% \n  mutate(rd_value = case_when(\n            ROAD_SURFACE == \"loose\" ~ 25,\n            ROAD_SURFACE == \"overgrown\" ~ 5,\n            ROAD_SURFACE == \"rough\" ~ 10,\n            ROAD_SURFACE == \"unknown\" ~ 7.5)) \n```\n:::\n\n\nNow we can convert this to a raster using the template we created already\n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-3_ce7adf133aa75a30609994895803d924'}\n\n```{.r .cell-code}\n# convert roads to a raster \nrroads <- rasterize(roads, template, field = \"rd_value\" )\n\nplot(rroads)\n```\n\n::: {.cell-output-display}\n![](07-processing-vector-data_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\nAs the impact of the roads is likely to impact a wider influence than a single pixal we can use a moving window analysis to expand the influence of roads for a given value. \n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-4_a962f3e9b975b0b8cdf5eb2132dec72b'}\n\n```{.r .cell-code}\n# create a moving window \nrrdens <- focal(rroads, w=9, fun=\"sum\", na.rm=TRUE)\n\nplot(rrdens)\n```\n\n::: {.cell-output-display}\n![](07-processing-vector-data_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-5_4ec52c05d3112ec936e5940bc7acaac7'}\n\n```{.r .cell-code}\nwriteRaster(rrdens, file.path(\"clean_data\", \"road_density.tif\"), overwrite = TRUE) \n```\n:::\n\n\n\n\n## 2. Calculate distance from water\n\nWhile density provides a measure of impact we may also be interested in capturing the distance of fixes to caribou points. In this case we will explore the distance to water bodies within the study areas. \n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-6_d9f44a1590695d2ead3f1f50b14c39d2'}\n\n```{.r .cell-code}\n# read in water \nwater <- st_read(file.path(\"clean_data\", \"roads.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `roads' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/roads.gpkg' \n  using driver `GPKG'\nSimple feature collection with 1077 features and 2 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\n# calculate the distance to water for each pixel in the raster\n# be patient - this might take some time. \nwater_dis <- distance(template, water, unit=\"km\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n:::\n\n```{.r .cell-code}\nplot(water_dis)\n```\n\n::: {.cell-output-display}\n![](07-processing-vector-data_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# what sort of values are we seeing?\nrange(water_dis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nclass       : SpatRaster \ndimensions  : 1484, 1616, 2  (nrow, ncol, nlyr)\nresolution  : 25, 25  (x, y)\nextent      : 1145200, 1185600, 1190400, 1227500  (xmin, xmax, ymin, ymax)\ncoord. ref. : NAD83 / BC Albers (EPSG:3005) \nsource(s)   : memory\nnames       :    range_min,    range_max \nmin values  : 9.219572e-05, 9.219572e-05 \nmax values  : 9.553006e+00, 9.553006e+00 \n```\n:::\n\n```{.r .cell-code}\nsort(unique(values(water_dis)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   [1] 9.219572e-05 1.666219e-04 1.803060e-04 1.993170e-04 2.053871e-04\n   [6] 2.070943e-04 2.131442e-04 2.139665e-04 2.361458e-04 2.545786e-04\n  [11] 2.579012e-04 2.582353e-04 2.688313e-04 2.882711e-04 3.353211e-04\n  [16] 3.495667e-04 3.503002e-04 3.590148e-04 3.633916e-04 3.726184e-04\n  [21] 3.743424e-04 3.844740e-04 3.879578e-04 3.916545e-04 3.969588e-04\n  [26] 4.046948e-04 4.077995e-04 4.270600e-04 4.272562e-04 4.379676e-04\n  [31] 4.446973e-04 4.606520e-04 4.628884e-04 4.630517e-04 4.760351e-04\n  [36] 4.801388e-04 5.017613e-04 5.055354e-04 5.107195e-04 5.256454e-04\n  [41] 5.357071e-04 5.376750e-04 5.380337e-04 5.398773e-04 5.495983e-04\n  [46] 5.705701e-04 5.844287e-04 6.004001e-04 6.135359e-04 6.260034e-04\n  [51] 6.311230e-04 6.476884e-04 6.527228e-04 6.541817e-04 6.747148e-04\n  [56] 6.775596e-04 6.993803e-04 6.997001e-04 7.132808e-04 7.134449e-04\n  [61] 7.174012e-04 7.180557e-04 7.192117e-04 7.244919e-04 7.296272e-04\n  [66] 7.333787e-04 7.334601e-04 7.366138e-04 7.378179e-04 7.394711e-04\n  [71] 7.405693e-04 7.529032e-04 7.556203e-04 7.569942e-04 7.581858e-04\n  [76] 7.616166e-04 7.777469e-04 7.789749e-04 7.805384e-04 7.812694e-04\n  [81] 7.886444e-04 8.001356e-04 8.079240e-04 8.115794e-04 8.130806e-04\n  [86] 8.136033e-04 8.148502e-04 8.169121e-04 8.185520e-04 8.230715e-04\n  [91] 8.282420e-04 8.317882e-04 8.381899e-04 8.405789e-04 8.491414e-04\n  [96] 8.503549e-04 8.514988e-04 8.557263e-04 8.665847e-04 8.692404e-04\n [101] 8.733120e-04 8.774703e-04 8.915394e-04 9.008198e-04 9.009718e-04\n [106] 9.089934e-04 9.101957e-04 9.113825e-04 9.253252e-04 9.259516e-04\n [111] 9.327698e-04 9.366912e-04 9.407154e-04 9.409842e-04 9.411637e-04\n [116] 9.455238e-04 9.526892e-04 9.528283e-04 9.585067e-04 9.591390e-04\n [121] 9.614751e-04 9.618760e-04 9.624061e-04 9.656718e-04 9.811093e-04\n [126] 9.948729e-04 9.997995e-04 1.006958e-03 1.010427e-03 1.010967e-03\n [131] 1.012458e-03 1.013560e-03 1.016628e-03 1.017868e-03 1.032285e-03\n [136] 1.033948e-03 1.048947e-03 1.050256e-03 1.052764e-03 1.055573e-03\n [141] 1.060641e-03 1.066625e-03 1.067445e-03 1.068113e-03 1.073275e-03\n [146] 1.075489e-03 1.077892e-03 1.080945e-03 1.082303e-03 1.083169e-03\n [151] 1.093868e-03 1.096705e-03 1.102057e-03 1.115372e-03 1.115417e-03\n [156] 1.117283e-03 1.124105e-03 1.124233e-03 1.125637e-03 1.135441e-03\n [161] 1.136185e-03 1.140322e-03 1.141385e-03 1.144753e-03 1.145280e-03\n [166] 1.145660e-03 1.150613e-03 1.152600e-03 1.156199e-03 1.164129e-03\n [171] 1.170587e-03 1.171038e-03 1.181640e-03 1.185443e-03 1.185820e-03\n [176] 1.187026e-03 1.187783e-03 1.188613e-03 1.188916e-03 1.192811e-03\n [181] 1.194268e-03 1.194308e-03 1.195054e-03 1.196984e-03 1.199855e-03\n [186] 1.201763e-03 1.207816e-03 1.207889e-03 1.208136e-03 1.215152e-03\n [191] 1.219822e-03 1.222670e-03 1.224104e-03 1.229433e-03 1.238591e-03\n [196] 1.249892e-03 1.250000e-03 1.250300e-03 1.253938e-03 1.255896e-03\n [201] 1.264272e-03 1.268639e-03 1.276729e-03 1.278445e-03 1.281722e-03\n [206] 1.282943e-03 1.284880e-03 1.290255e-03 1.293234e-03 1.294109e-03\n [211] 1.303270e-03 1.313799e-03 1.313848e-03 1.315634e-03 1.317029e-03\n [216] 1.318280e-03 1.320772e-03 1.321516e-03 1.322203e-03 1.326234e-03\n [221] 1.326375e-03 1.335689e-03 1.336303e-03 1.338512e-03 1.344473e-03\n [226] 1.345141e-03 1.346551e-03 1.346600e-03 1.348467e-03 1.349616e-03\n [231] 1.351048e-03 1.355411e-03 1.356282e-03 1.357455e-03 1.359036e-03\n [236] 1.359091e-03 1.360253e-03 1.364659e-03 1.372845e-03 1.373797e-03\n [241] 1.377836e-03 1.381041e-03 1.381626e-03 1.382433e-03 1.394443e-03\n [246] 1.394504e-03 1.394871e-03 1.399266e-03 1.405014e-03 1.408405e-03\n [251] 1.410593e-03 1.414917e-03 1.417245e-03 1.424102e-03 1.424271e-03\n [256] 1.424330e-03 1.424387e-03 1.426941e-03 1.428732e-03 1.430804e-03\n [261] 1.432156e-03 1.435008e-03 1.443226e-03 1.445372e-03 1.449151e-03\n [266] 1.451821e-03 1.457687e-03 1.471017e-03 1.472572e-03 1.472893e-03\n [271] 1.473231e-03 1.476616e-03 1.477703e-03 1.477938e-03 1.482174e-03\n [276] 1.486854e-03 1.486983e-03 1.487098e-03 1.488952e-03 1.489834e-03\n [281] 1.492376e-03 1.492657e-03 1.496591e-03 1.499388e-03 1.499500e-03\n [286] 1.503414e-03 1.504467e-03 1.508191e-03 1.514556e-03 1.515354e-03\n [291] 1.517752e-03 1.517818e-03 1.518332e-03 1.518926e-03 1.521052e-03\n [296] 1.525664e-03 1.527344e-03 1.529333e-03 1.539208e-03 1.541616e-03\n [301] 1.544840e-03 1.545971e-03 1.550069e-03 1.551290e-03 1.552449e-03\n [306] 1.552897e-03 1.553168e-03 1.554930e-03 1.557208e-03 1.557388e-03\n [311] 1.562866e-03 1.563096e-03 1.565502e-03 1.567745e-03 1.568561e-03\n [316] 1.574908e-03 1.575456e-03 1.580485e-03 1.581596e-03 1.585798e-03\n [321] 1.585818e-03 1.586583e-03 1.587087e-03 1.587762e-03 1.588645e-03\n [326] 1.591879e-03 1.593568e-03 1.594929e-03 1.597546e-03 1.600906e-03\n [331] 1.602108e-03 1.605819e-03 1.607490e-03 1.608937e-03 1.612385e-03\n [336] 1.612754e-03 1.614630e-03 1.616241e-03 1.619070e-03 1.619179e-03\n [341] 1.627625e-03 1.628938e-03 1.632033e-03 1.632531e-03 1.635754e-03\n [346] 1.642183e-03 1.645566e-03 1.645875e-03 1.649349e-03 1.651663e-03\n [351] 1.652697e-03 1.653234e-03 1.655015e-03 1.655614e-03 1.658187e-03\n [356] 1.661644e-03 1.662203e-03 1.664306e-03 1.672115e-03 1.673718e-03\n [361] 1.675962e-03 1.676013e-03 1.676102e-03 1.677494e-03 1.684278e-03\n [366] 1.685472e-03 1.690003e-03 1.690297e-03 1.696088e-03 1.696487e-03\n [371] 1.698271e-03 1.701613e-03 1.703948e-03 1.710190e-03 1.712331e-03\n [376] 1.714327e-03 1.719636e-03 1.723006e-03 1.723691e-03 1.727164e-03\n [381] 1.731514e-03 1.731645e-03 1.733455e-03 1.733975e-03 1.735267e-03\n [386] 1.739167e-03 1.746291e-03 1.746334e-03 1.747611e-03 1.750357e-03\n [391] 1.751560e-03 1.753630e-03 1.756816e-03 1.760375e-03 1.762182e-03\n [396] 1.763273e-03 1.765046e-03 1.766823e-03 1.767329e-03 1.770252e-03\n [401] 1.772989e-03 1.779953e-03 1.780207e-03 1.784317e-03 1.784321e-03\n [406] 1.785125e-03 1.786877e-03 1.791046e-03 1.791430e-03 1.792122e-03\n [411] 1.796202e-03 1.796467e-03 1.806265e-03 1.807401e-03 1.812071e-03\n [416] 1.815322e-03 1.816489e-03 1.816534e-03 1.819560e-03 1.819890e-03\n [421] 1.820560e-03 1.820762e-03 1.827376e-03 1.829926e-03 1.833643e-03\n [426] 1.835298e-03 1.844196e-03 1.844530e-03 1.849282e-03 1.849482e-03\n [431] 1.850986e-03 1.854402e-03 1.858353e-03 1.859546e-03 1.867086e-03\n [436] 1.869292e-03 1.871142e-03 1.872605e-03 1.873040e-03 1.876100e-03\n [441] 1.877411e-03 1.879627e-03 1.880109e-03 1.881179e-03 1.882138e-03\n [446] 1.882785e-03 1.884784e-03 1.887832e-03 1.892822e-03 1.895514e-03\n [451] 1.897069e-03 1.898426e-03 1.904515e-03 1.905871e-03 1.908226e-03\n [456] 1.909059e-03 1.911218e-03 1.913492e-03 1.913929e-03 1.919589e-03\n [461] 1.920687e-03 1.921273e-03 1.923414e-03 1.923616e-03 1.924032e-03\n [466] 1.928481e-03 1.934548e-03 1.936932e-03 1.938647e-03 1.940573e-03\n [471] 1.941770e-03 1.946042e-03 1.946416e-03 1.946648e-03 1.946650e-03\n [476] 1.947368e-03 1.947673e-03 1.949419e-03 1.952021e-03 1.952063e-03\n [481] 1.952416e-03 1.956680e-03 1.957011e-03 1.957224e-03 1.958591e-03\n [486] 1.959309e-03 1.961893e-03 1.965525e-03 1.966791e-03 1.967840e-03\n [491] 1.972575e-03 1.974756e-03 1.975486e-03 1.976311e-03 1.976934e-03\n [496] 1.980850e-03 1.981485e-03 1.983095e-03 1.986564e-03 1.986699e-03\n [501] 1.987283e-03 1.989228e-03 1.989408e-03 1.990345e-03 1.991233e-03\n [506] 1.991377e-03 1.992568e-03 1.996306e-03 1.996632e-03 2.000000e-03\n [511] 2.000315e-03 2.000771e-03 2.001448e-03 2.001586e-03 2.002679e-03\n [516] 2.006629e-03 2.010085e-03 2.010124e-03 2.013654e-03 2.014944e-03\n [521] 2.015130e-03 2.016335e-03 2.017466e-03 2.022138e-03 2.022404e-03\n [526] 2.023612e-03 2.024046e-03 2.026552e-03 2.027188e-03 2.029723e-03\n [531] 2.030028e-03 2.030385e-03 2.030517e-03 2.035392e-03 2.039046e-03\n [536] 2.040213e-03 2.041017e-03 2.041399e-03 2.043656e-03 2.043731e-03\n [541] 2.046050e-03 2.047279e-03 2.048393e-03 2.052103e-03 2.052462e-03\n [546] 2.054534e-03 2.055955e-03 2.062898e-03 2.062924e-03 2.063021e-03\n [551] 2.063716e-03 2.068008e-03 2.068827e-03 2.071961e-03 2.071982e-03\n [556] 2.072074e-03 2.074940e-03 2.075254e-03 2.075517e-03 2.079477e-03\n [561] 2.083094e-03 2.086339e-03 2.086457e-03 2.087774e-03 2.088964e-03\n [566] 2.089754e-03 2.089996e-03 2.090113e-03 2.093566e-03 2.095591e-03\n [571] 2.096274e-03 2.097657e-03 2.102501e-03 2.107620e-03 2.110554e-03\n [576] 2.111334e-03 2.115040e-03 2.121303e-03 2.121938e-03 2.124700e-03\n [581] 2.124763e-03 2.124924e-03 2.126173e-03 2.129519e-03 2.131842e-03\n [586] 2.132129e-03 2.132317e-03 2.134226e-03 2.134724e-03 2.136070e-03\n [591] 2.136177e-03 2.136263e-03 2.140941e-03 2.141115e-03 2.141340e-03\n [596] 2.141792e-03 2.144099e-03 2.146341e-03 2.146375e-03 2.146990e-03\n [601] 2.150570e-03 2.154272e-03 2.154847e-03 2.155553e-03 2.157873e-03\n [606] 2.161969e-03 2.164369e-03 2.164577e-03 2.164918e-03 2.173501e-03\n [611] 2.173507e-03 2.177371e-03 2.179069e-03 2.179823e-03 2.181206e-03\n [616] 2.182043e-03 2.182666e-03 2.189554e-03 2.192435e-03 2.193272e-03\n [621] 2.198002e-03 2.198127e-03 2.198914e-03 2.199563e-03 2.200975e-03\n [626] 2.203227e-03 2.203623e-03 2.204081e-03 2.206991e-03 2.207783e-03\n [631] 2.210742e-03 2.214707e-03 2.215104e-03 2.217880e-03 2.218546e-03\n [636] 2.221568e-03 2.223732e-03 2.224167e-03 2.225079e-03 2.227668e-03\n [641] 2.230408e-03 2.231755e-03 2.231890e-03 2.233531e-03 2.234513e-03\n [646] 2.235844e-03 2.236119e-03 2.236772e-03 2.238014e-03 2.238518e-03\n [651] 2.239111e-03 2.242626e-03 2.242856e-03 2.243384e-03 2.244928e-03\n [656] 2.246340e-03 2.246934e-03 2.249106e-03 2.250925e-03 2.255899e-03\n [661] 2.256484e-03 2.257287e-03 2.258945e-03 2.259175e-03 2.259662e-03\n [666] 2.261862e-03 2.262367e-03 2.266035e-03 2.266194e-03 2.266727e-03\n [671] 2.269504e-03 2.269803e-03 2.271992e-03 2.275190e-03 2.277935e-03\n [676] 2.278544e-03 2.279712e-03 2.279854e-03 2.280658e-03 2.286998e-03\n [681] 2.288165e-03 2.289718e-03 2.292310e-03 2.296227e-03 2.296333e-03\n [686] 2.298094e-03 2.302273e-03 2.306033e-03 2.307157e-03 2.308253e-03\n [691] 2.309046e-03 2.312620e-03 2.314267e-03 2.319352e-03 2.320243e-03\n [696] 2.320266e-03 2.324989e-03 2.329267e-03 2.330704e-03 2.331235e-03\n [701] 2.332624e-03 2.340301e-03 2.344633e-03 2.344897e-03 2.345628e-03\n [706] 2.346685e-03 2.351400e-03 2.353116e-03 2.354988e-03 2.355702e-03\n [711] 2.355824e-03 2.357983e-03 2.358230e-03 2.359758e-03 2.360653e-03\n [716] 2.361256e-03 2.361581e-03 2.363569e-03 2.365646e-03 2.369420e-03\n [721] 2.371866e-03 2.371901e-03 2.372242e-03 2.372791e-03 2.372865e-03\n [726] 2.374934e-03 2.376510e-03 2.381029e-03 2.381689e-03 2.381852e-03\n [731] 2.381972e-03 2.382878e-03 2.388378e-03 2.388379e-03 2.388690e-03\n [736] 2.389273e-03 2.389603e-03 2.389640e-03 2.389780e-03 2.394854e-03\n [741] 2.395824e-03 2.396283e-03 2.397402e-03 2.398050e-03 2.398437e-03\n [746] 2.401156e-03 2.402768e-03 2.403929e-03 2.405625e-03 2.406130e-03\n [751] 2.407895e-03 2.409519e-03 2.409935e-03 2.410821e-03 2.411150e-03\n [756] 2.411217e-03 2.412822e-03 2.414033e-03 2.414543e-03 2.415434e-03\n [761] 2.415853e-03 2.418479e-03 2.419377e-03 2.420676e-03 2.424503e-03\n [766] 2.426552e-03 2.428435e-03 2.429521e-03 2.429986e-03 2.430176e-03\n [771] 2.431801e-03 2.432127e-03 2.432809e-03 2.433090e-03 2.434176e-03\n [776] 2.438731e-03 2.438842e-03 2.441067e-03 2.441455e-03 2.444060e-03\n [781] 2.444216e-03 2.448822e-03 2.449748e-03 2.450720e-03 2.452323e-03\n [786] 2.456488e-03 2.458349e-03 2.459751e-03 2.462980e-03 2.466097e-03\n [791] 2.466489e-03 2.468555e-03 2.470802e-03 2.471314e-03 2.472158e-03\n [796] 2.473669e-03 2.474248e-03 2.474917e-03 2.475227e-03 2.478109e-03\n [801] 2.480326e-03 2.480946e-03 2.488616e-03 2.490088e-03 2.490471e-03\n [806] 2.490599e-03 2.490998e-03 2.492038e-03 2.494851e-03 2.496435e-03\n [811] 2.496711e-03 2.497251e-03 2.498807e-03 2.498891e-03 2.499000e-03\n [816] 2.499181e-03 2.499220e-03 2.503325e-03 2.504255e-03 2.507037e-03\n [821] 2.507720e-03 2.507844e-03 2.508106e-03 2.508565e-03 2.509134e-03\n [826] 2.510685e-03 2.515326e-03 2.516309e-03 2.516700e-03 2.517105e-03\n [831] 2.517848e-03 2.521420e-03 2.526485e-03 2.526614e-03 2.528100e-03\n [836] 2.529451e-03 2.533742e-03 2.535122e-03 2.535729e-03 2.535794e-03\n [841] 2.538233e-03 2.538468e-03 2.539973e-03 2.540710e-03 2.542198e-03\n [846] 2.542237e-03 2.543299e-03 2.543893e-03 2.544847e-03 2.546459e-03\n [851] 2.549839e-03 2.550746e-03 2.551460e-03 2.561349e-03 2.562835e-03\n [856] 2.563780e-03 2.564093e-03 2.565278e-03 2.565339e-03 2.565678e-03\n [861] 2.569765e-03 2.571889e-03 2.576538e-03 2.581547e-03 2.585223e-03\n [866] 2.586419e-03 2.587536e-03 2.587880e-03 2.592935e-03 2.593370e-03\n [871] 2.593700e-03 2.594023e-03 2.594512e-03 2.597233e-03 2.599676e-03\n [876] 2.601235e-03 2.602626e-03 2.603828e-03 2.605816e-03 2.606659e-03\n [881] 2.609607e-03 2.610948e-03 2.612536e-03 2.615979e-03 2.617172e-03\n [886] 2.617927e-03 2.621735e-03 2.621835e-03 2.622068e-03 2.625513e-03\n [891] 2.626547e-03 2.627321e-03 2.628545e-03 2.629045e-03 2.629060e-03\n [896] 2.629794e-03 2.630777e-03 2.630866e-03 2.630874e-03 2.631226e-03\n [901] 2.631655e-03 2.633432e-03 2.635862e-03 2.636590e-03 2.636692e-03\n [906] 2.636936e-03 2.637618e-03 2.640267e-03 2.640581e-03 2.642679e-03\n [911] 2.645060e-03 2.647923e-03 2.648364e-03 2.648553e-03 2.649306e-03\n [916] 2.650179e-03 2.651056e-03 2.651390e-03 2.652361e-03 2.653305e-03\n [921] 2.654116e-03 2.654901e-03 2.656132e-03 2.657913e-03 2.657916e-03\n [926] 2.661486e-03 2.662206e-03 2.663545e-03 2.665630e-03 2.668499e-03\n [931] 2.673935e-03 2.674032e-03 2.674384e-03 2.677846e-03 2.678439e-03\n [936] 2.679923e-03 2.682914e-03 2.683371e-03 2.683785e-03 2.685430e-03\n [941] 2.686104e-03 2.689142e-03 2.690261e-03 2.691198e-03 2.692210e-03\n [946] 2.692499e-03 2.692768e-03 2.695484e-03 2.697314e-03 2.697603e-03\n [951] 2.699722e-03 2.700770e-03 2.701298e-03 2.707345e-03 2.713652e-03\n [956] 2.714700e-03 2.715109e-03 2.716296e-03 2.716739e-03 2.718532e-03\n [961] 2.718763e-03 2.719154e-03 2.720682e-03 2.726511e-03 2.726712e-03\n [966] 2.727351e-03 2.729099e-03 2.729119e-03 2.730461e-03 2.730880e-03\n [971] 2.731081e-03 2.732108e-03 2.738402e-03 2.738967e-03 2.739051e-03\n [976] 2.739835e-03 2.742986e-03 2.745242e-03 2.746077e-03 2.746382e-03\n [981] 2.746408e-03 2.750284e-03 2.751791e-03 2.754305e-03 2.760375e-03\n [986] 2.761372e-03 2.761766e-03 2.761794e-03 2.762700e-03 2.767849e-03\n [991] 2.768525e-03 2.768621e-03 2.768900e-03 2.770130e-03 2.773837e-03\n [996] 2.774899e-03 2.777036e-03 2.777719e-03 2.779187e-03 2.779293e-03\n [ reached getOption(\"max.print\") -- omitted 2397083 entries ]\n```\n:::\n\n```{.r .cell-code}\nrange(unique(values(water_dis)))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9.219572e-05 9.553006e+00\n```\n:::\n:::\n\n\n\n## 3. Convert base vector data to rasters \n\nWe can also convert each vector layer we extracted into a raster. \n\n\nNote this can also be done at the vector stage, however predictive modelling will normally require a stacked covariate list so that you can predict from the built model \n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-7_fea325182765608572a51b8ff3f461c2'}\n\n```{.r .cell-code}\nbec <- st_read(file.path(\"clean_data\",\"bec.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `bec' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/bec.gpkg' \n  using driver `GPKG'\nSimple feature collection with 67 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\nvri_cc <- st_read(file.path(\"clean_data\",\"vri_cc.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `vri_cc' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/vri_cc.gpkg' \n  using driver `GPKG'\nSimple feature collection with 11254 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\nvri_conif <- st_read(file.path(\"clean_data\",\"vri_conif.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `vri_conif' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/vri_conif.gpkg' \n  using driver `GPKG'\nSimple feature collection with 7572 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\nvri_ageclass <- st_read(file.path(\"clean_data\",\"vri_ageclass.gpkg\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `vri_ageclass' from data source \n  `/Users/andy/dev/r-telemetry-workshop-nov-2023/clean_data/vri_ageclass.gpkg' \n  using driver `GPKG'\nSimple feature collection with 9488 features and 1 field\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 1145200 ymin: 1190300 xmax: 1185600 ymax: 1227500\nProjected CRS: NAD83 / BC Albers\n```\n:::\n\n```{.r .cell-code}\n#water\n#roads \n#cutblocks\n\n\n\n\n# convert to rasters\nvri_cc <- rasterize(vri_cc, template, field = \"cc_class\" )\nvri_conif <- rasterize(vri_conif, template, field = \"conif\" )\nvri_ageclass <- rasterize(vri_ageclass, template, field = \"age_class\" )\n\n\n# stack into a set of rasters\nvect_stack <- c(vri_cc, vri_conif, vri_ageclass, water_dis, rrdens)\n```\n:::\n\n\n## Lets combine our already created rasters \n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-8_0bdca7cfa0377633a9ad04ff82ef7a29'}\n\n```{.r .cell-code}\nrslope <- rast(file.path(\"clean_data\",\"slope.tif\"))\naspect <- rast(file.path(\"clean_data\",\"aspect.tif\"))\ntri  <- rast(file.path(\"clean_data\",\"tri.tif\"))\ntrim_3005 <- rast(file.path(\"clean_data\",\"dem.tif\"))\n\n\n\n# create a raster stack\nrast_stack <- c(trim_3005, rslope, aspect, tri)\n```\n:::\n\n\n\n## 4. Combine raster layers into a stack \n\n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-9_6ea9806ab05e79df3e6a7aec13fdbe2d'}\n\n```{.r .cell-code}\n# lets combine both the raster stack and the vector stack \n\nall_stack <- c(vect_stack, rast_stack)\n\nplot(all_stack)\n```\n\n::: {.cell-output-display}\n![](07-processing-vector-data_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# we can write this out as a tif (raster object) \n#writeRaster(all_stack, file.path(\"clean_data\", \"rstack.tif\"), overwrite = T)\n```\n:::\n\n\nOr we can write this out to a very small R object \n\n::: {.cell hash='07-processing-vector-data_cache/html/unnamed-chunk-10_0ee15ec32527abcd865427c6f2c449de'}\n\n```{.r .cell-code}\nsaveRDS(all_stack, file.path(\"clean_data\", \"covars.RDS\")) # much faster\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}